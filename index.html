<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="referrer" content="no-referrer">
<title>Cinema Box Office â€” Fixed</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<style>
    /* Garde ton CSS original exactement comme il Ã©tait */
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: 'Georgia', serif; background:#0a0a0a; color:#f5f5f5; min-height:100vh; padding:20px; }
    .container { max-width:1400px; margin:0 auto; }
    h1 { text-align:center; font-size:3.2em; margin-bottom:8px; color:#d4af37; text-shadow:3px 3px 6px rgba(212,175,55,0.3); }
    .subtitle { text-align:center; color:#8b7355; margin-bottom:28px; font-size:1.1em; font-style:italic; }
    .controls { background:linear-gradient(135deg,#1a1a1a 0%,#2d2d2d 100%); border-radius:10px; padding:20px; margin-bottom:20px; border:2px solid #d4af37; box-shadow:0 4px 20px rgba(212,175,55,0.2); }
    .control-group { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:16px; margin-bottom:12px; }
    label { color:#d4af37; margin-bottom:8px; font-weight:bold; font-size:0.85em; text-transform:uppercase; letter-spacing:1px; }
    select,input { padding:10px; border-radius:6px; border:2px solid #8b7355; background:#1a1a1a; color:#f5f5f5; font-size:0.95em; }
    .stats-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:16px; margin:18px 0; }
    .stat-card { background:linear-gradient(135deg,#2d2d2d 0%,#1a1a1a 100%); border-radius:10px; padding:16px; border:2px solid #d4af37; box-shadow:0 4px 15px rgba(212,175,55,0.15); }
    .stat-label { font-size:0.85em; color:#8b7355; margin-bottom:8px; text-transform:uppercase; letter-spacing:1px; }
    .stat-value { font-size:1.7em; font-weight:bold; color:#d4af37; }
    .viz-container { background:linear-gradient(135deg,#1a1a1a 0%,#2d2d2d 100%); border-radius:10px; padding:20px; margin-bottom:20px; border:2px solid #d4af37; box-shadow:0 4px 20px rgba(212,175,55,0.2); }
    .viz-title { font-size:1.4em; margin-bottom:14px; color:#d4af37; text-align:center; text-transform:uppercase; letter-spacing:2px; }
    .tooltip { position:absolute; background:rgba(0,0,0,0.95); color:#f5f5f5; padding:12px; border-radius:8px; pointer-events:none; opacity:0; transition:opacity 0.15s; font-size:0.9em; max-width:320px; border:2px solid #d4af37; box-shadow:0 6px 24px rgba(0,0,0,0.8); z-index:1000; }
    .tooltip.active { opacity:1; }
    .tooltip-title { font-size:1.05em; color:#d4af37; margin-bottom:6px; font-weight:bold; }
    .movie-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:18px; }
    .movie-card { background:#2d2d2d; border-radius:10px; overflow:hidden; transition:all 0.22s; border:2px solid transparent; cursor:pointer; }
    .movie-card:hover { transform:translateY(-8px); border-color:#d4af37; box-shadow:0 10px 30px rgba(212,175,55,0.25); }
    .movie-poster { width:100%; height:300px; object-fit:cover; display:block; background: #1a1a1a; }
    .movie-info { padding:12px; }
    .movie-title { font-size:1.05em; color:#d4af37; margin-bottom:6px; font-weight:bold; }
    .movie-details { color:#8b7355; font-size:0.9em; line-height:1.5; }
    .tab-container { display:flex; gap:10px; margin-bottom:14px; flex-wrap:wrap; justify-content:center; }
    .tab { padding:10px 16px; background:#2d2d2d; border:2px solid #8b7355; border-radius:6px; cursor:pointer; color:#8b7355; font-weight:bold; text-transform:uppercase; letter-spacing:1px; }
    .tab.active { background:linear-gradient(135deg,#d4af37 0%,#b8941f 100%); border-color:#d4af37; color:#0a0a0a; }
    .axis text { fill:#8b7355; font-size:12px; }
    .axis line,.axis path { stroke:#8b7355; }
    .grid line { stroke: rgba(139,115,85,0.12); }
    button { background:linear-gradient(135deg,#d4af37 0%,#b8941f 100%); color:#0a0a0a; border:none; padding:10px 16px; border-radius:6px; cursor:pointer; font-size:0.95em; font-weight:bold; text-transform:uppercase; }
    button:hover { transform:translateY(-1px); box-shadow:0 6px 18px rgba(212,175,55,0.3); }
    @media (max-width:560px){ .movie-poster{height:220px} }
</style>
</head>
<body>
<div class="container">
    <h1>ðŸŽ¬ CINEMA</h1>
    <p class="subtitle">Box Office Explorer â€” Fixed & Completed</p>

    <div class="controls">
        <div class="control-group">
            <div>
                <label for="yearFilter">Year</label>
                <select id="yearFilter"><option value="all">All Years</option></select>
            </div>
            <div>
                <label for="genreFilter">Genre</label>
                <select id="genreFilter"><option value="all">All Genres</option></select>
            </div>
            <div>
                <label for="directorFilter">Director</label>
                <select id="directorFilter"><option value="all">All Directors</option></select>
            </div>
            <div>
                <label for="actorFilter">Lead Actor</label>
                <select id="actorFilter"><option value="all">All Actors</option></select>
            </div>
        </div>
        <div style="display:flex; gap:12px; justify-content:flex-end;">
            <button onclick="resetFilters()">Reset Filters</button>
        </div>
    </div>

    <div class="stats-grid">
        <div class="stat-card"><div class="stat-label">Total Movies</div><div class="stat-value" id="totalMovies">0</div></div>
        <div class="stat-card"><div class="stat-label">Total Box Office</div><div class="stat-value" id="totalBoxOffice">$0B</div></div>
        <div class="stat-card"><div class="stat-label">Average Revenue</div><div class="stat-value" id="avgRevenue">$0M</div></div>
        <div class="stat-card"><div class="stat-label">Top Genre</div><div class="stat-value" id="topGenre">-</div></div>
    </div>

    <div class="tab-container">
        <div class="tab active" onclick="switchTab(event,'overview')">Overview</div>
        <div class="tab" onclick="switchTab(event,'genre')">Genre Analysis</div>
        <div class="tab" onclick="switchTab(event,'director')">Directors</div>
        <div class="tab" onclick="switchTab(event,'timeline')">Timeline</div>
        <div class="tab" onclick="switchTab(event,'gallery')">Movie Gallery</div>
    </div>

    <div class="viz-container" id="overviewViz">
        <h2 class="viz-title">Box Office Scatter (by year)</h2>
        <div id="mainChart" style="width:100%; min-height:480px;"></div>
    </div>

    <div class="viz-container" id="genreViz" style="display:none;">
        <h2 class="viz-title">Genre Revenue</h2>
        <div id="genreChart" style="width:100%; min-height:480px;"></div>
    </div>

    <div class="viz-container" id="directorViz" style="display:none;">
        <h2 class="viz-title">Top Directors</h2>
        <div id="directorChart" style="width:100%; min-height:480px;"></div>
    </div>

    <div class="viz-container" id="timelineViz" style="display:none;">
        <h2 class="viz-title">Box Office Timeline</h2>
        <div id="timelineChart" style="width:100%; min-height:480px;"></div>
    </div>

    <div class="viz-container" id="galleryViz" style="display:none;">
        <h2 class="viz-title">Movie Gallery</h2>
        <div id="movieGrid" class="movie-grid"></div>
    </div>
</div>

<div class="tooltip" id="tooltip"></div>

<script>
// --- DONNÃ‰ES ---
const movieData = [
  {year:2013,title:"Frozen",boxOffice:1280.8,genre:"Animation",director:"Chris Buck, Jennifer Lee",actor:"Kristen Bell",poster:"https://image.tmdb.org/t/p/w500/kgwjIb1CkFCMvELmFzjS5tpAE9h.jpg"},
  {year:2013,title:"Iron Man 3",boxOffice:1214.8,genre:"Action / Super-hÃ©ros",director:"Shane Black",actor:"Robert Downey Jr.",poster:"https://image.tmdb.org/t/p/w500/qhPtAc1TKbMPqNvcdXSOn9Bn7hZ.jpg"},
  {year:2013,title:"Despicable Me 2",boxOffice:970.7,genre:"Animation",director:"Pierre Coffin, Chris Renaud",actor:"Steve Carell",poster:"https://image.tmdb.org/t/p/w500/5Fh4NdoEnCjENLwQgetSsJk9qjH.jpg"},
  {year:2013,title:"The Hobbit: Desolation of Smaug",boxOffice:958.3,genre:"Fantasy",director:"Peter Jackson",actor:"Martin Freeman",poster:"https://image.tmdb.org/t/p/w500/xQYiXsmeW7RSXyoKT526s1YFr04.jpg"},
  {year:2013,title:"Hunger Games: Catching Fire",boxOffice:865.0,genre:"Science-fiction",director:"Francis Lawrence",actor:"Jennifer Lawrence",poster:"https://image.tmdb.org/t/p/w500/v9qVkyS467dGTeCu8Y8BDLhJGIh.jpg"},
  {year:2014,title:"Transformers: Age of Extinction",boxOffice:1104.0,genre:"Action / Science-fiction",director:"Michael Bay",actor:"Mark Wahlberg",poster:"https://image.tmdb.org/t/p/w500/jyzrfx2WaeY60kYZpPYepSjGz4S.jpg"},
  {year:2014,title:"The Hobbit: Battle of the Five Armies",boxOffice:962.2,genre:"Fantasy",director:"Peter Jackson",actor:"Martin Freeman",poster:"https://image.tmdb.org/t/p/w500/9zePziPFOy2cV1kGPi4KcNdsSsY.jpg"},
  {year:2014,title:"Guardians of the Galaxy",boxOffice:773.3,genre:"Action / Science-fiction",director:"James Gunn",actor:"Chris Pratt",poster:"https://image.tmdb.org/t/p/w500/r7vmZjiyZw9rpJMQJdXpjgiCOk9.jpg"},
  {year:2014,title:"Maleficent",boxOffice:758.5,genre:"Fantasy",director:"Robert Stromberg",actor:"Angelina Jolie",poster:"https://image.tmdb.org/t/p/w500/bDG3yei6AJlEAK3A5wN7RwFXQ7V.jpg"},
  {year:2014,title:"Hunger Games: Mockingjay â€“ P1",boxOffice:755.3,genre:"Science-fiction",director:"Francis Lawrence",actor:"Jennifer Lawrence",poster:"https://image.tmdb.org/t/p/w500/cWERd8rgbw7bCMZlwP207HUXxym.jpg"},
  {year:2015,title:"Star Wars: Force Awakens",boxOffice:2068.2,genre:"Science-fiction",director:"J. J. Abrams",actor:"Harrison Ford",poster:"https://image.tmdb.org/t/p/w500/wqnLdwVXoBjKibFRR5U3y0aDUhs.jpg"},
  {year:2015,title:"Jurassic World",boxOffice:1671.5,genre:"Science-fiction",director:"Colin Trevorrow",actor:"Chris Pratt",poster:"https://image.tmdb.org/t/p/w500/jw7Q4W5GpJhBVz4AClFU0KoNEm9.jpg"},
  {year:2015,title:"Furious 7",boxOffice:1515.3,genre:"Action",director:"James Wan",actor:"Vin Diesel",poster:"https://image.tmdb.org/t/p/w500/dCgm7efXDmiABSdWDHBDBx2jwmn.jpg"},
  {year:2015,title:"Avengers: Age of Ultron",boxOffice:1402.8,genre:"Action / Super-hÃ©ros",director:"Joss Whedon",actor:"Robert Downey Jr.",poster:"https://image.tmdb.org/t/p/w500/4ssDuvEDkSArWEdyBl2X5EHvYKU.jpg"},
  {year:2015,title:"Minions",boxOffice:1159.4,genre:"Animation",director:"Pierre Coffin, Kyle Balda",actor:"Sandra Bullock",poster:"https://image.tmdb.org/t/p/w500/dr02BdCNAUPVU07aOodwPYv6HCf.jpg"},
  {year:2016,title:"Captain America: Civil War",boxOffice:1153.3,genre:"Action / Super-hÃ©ros",director:"Anthony & Joe Russo",actor:"Chris Evans",poster:"https://image.tmdb.org/t/p/w500/rAGiXaUfPu0D8qCMw4tUX8H5Zwi.jpg"},
  {year:2016,title:"Rogue One: A Star Wars Story",boxOffice:1056.0,genre:"Science-fiction",director:"Gareth Edwards",actor:"Felicity Jones",poster:"https://image.tmdb.org/t/p/w500/i0yw1mFbB7sNGHCs7EXZPzFkdA1.jpg"},
  {year:2016,title:"Finding Dory",boxOffice:1028.5,genre:"Animation",director:"Andrew Stanton",actor:"Ellen DeGeneres",poster:"https://image.tmdb.org/t/p/w500/yFjVlsJmEMacU0BNUwdGZlo2ixq.jpg"},
  {year:2016,title:"Zootopia",boxOffice:1025.5,genre:"Animation",director:"Byron Howard, Rich Moore",actor:"Ginnifer Goodwin",poster:"https://image.tmdb.org/t/p/w500/hlK0e0wAQ3VLuJcsfIYPvTLS6QQ.jpg"},
  {year:2016,title:"The Jungle Book",boxOffice:967.7,genre:"Aventure / Fantasy",director:"Jon Favreau",actor:"Neel Sethi",poster:"https://image.tmdb.org/t/p/w500/vOipe2myi26UDwP978hsYOrnUWC.jpg"},
  {year:2017,title:"Star Wars: Last Jedi",boxOffice:1334.4,genre:"Science-fiction",director:"Rian Johnson",actor:"Mark Hamill",poster:"https://image.tmdb.org/t/p/w500/kOVEVeg59E0wsnXmF9nrh6OmWII.jpg"},
  {year:2017,title:"Beauty and the Beast",boxOffice:1266.1,genre:"Fantasy",director:"Bill Condon",actor:"Emma Watson",poster:"https://image.tmdb.org/t/p/w500/hKegSKIDep2ewJWPUQD7u0KqFIp.jpg"},
  {year:2017,title:"The Fate of the Furious",boxOffice:1236.0,genre:"Action",director:"F. Gary Gray",actor:"Vin Diesel",poster:"https://image.tmdb.org/t/p/w500/dImWM7GJqryWJO9LHa3XQ8DD5NH.jpg"},
  {year:2017,title:"Despicable Me 3",boxOffice:1034.8,genre:"Animation",director:"Kyle Balda",actor:"Steve Carell",poster:"https://image.tmdb.org/t/p/w500/6t3YWl7hrr88lCEFlGmyCz1TcoB.jpg"},
  {year:2017,title:"Jumanji: Welcome to the Jungle",boxOffice:962.1,genre:"Aventure",director:"Jake Kasdan",actor:"Dwayne Johnson",poster:"https://image.tmdb.org/t/p/w500/bXrZ5iHBEjH7WMidbUDQ0U2xbmR.jpg"},
  {year:2018,title:"Avengers: Infinity War",boxOffice:2048.3,genre:"Action / Super-hÃ©ros",director:"Anthony & Joe Russo",actor:"Robert Downey Jr.",poster:"https://image.tmdb.org/t/p/w500/7WsyChQLEftFiDOVTGkv3hFpyyt.jpg"},
  {year:2018,title:"Black Panther",boxOffice:1347.5,genre:"Action / Super-hÃ©ros",director:"Ryan Coogler",actor:"Chadwick Boseman",poster:"https://image.tmdb.org/t/p/w500/uxzzxijgPIY7slzFvMotPv8wjKA.jpg"},
  {year:2018,title:"Jurassic World: Fallen Kingdom",boxOffice:1308.4,genre:"Science-fiction",director:"J. A. Bayona",actor:"Chris Pratt",poster:"https://image.tmdb.org/t/p/w500/c9XxwwhPHdaImA2f1WEfEsbhaFB.jpg"},
  {year:2018,title:"Incredibles 2",boxOffice:1242.8,genre:"Animation",director:"Brad Bird",actor:"Craig T. Nelson",poster:"https://image.tmdb.org/t/p/w500/9lFKBtaVIhP7E2Pk0IY1CwTKTMZ.jpg"},
  {year:2018,title:"Aquaman",boxOffice:1148.5,genre:"Action / Super-hÃ©ros",director:"James Wan",actor:"Jason Momoa",poster:"https://image.tmdb.org/t/p/w500/zdw7Wf97vsQ0YnGomxDqfcEdUjX.jpg"},
  {year:2019,title:"Avengers: Endgame",boxOffice:2797.5,genre:"Action / Super-hÃ©ros",director:"Anthony & Joe Russo",actor:"Robert Downey Jr.",poster:"https://image.tmdb.org/t/p/w500/or06FN3Dka5tukK1e9sl16pB3iy.jpg"},
  {year:2019,title:"The Lion King",boxOffice:1656.9,genre:"Animation",director:"Jon Favreau",actor:"Donald Glover",poster:"https://image.tmdb.org/t/p/w500/dzBtMocZuJbjLOXvrl4zGYigDzh.jpg"},
  {year:2019,title:"Frozen II",boxOffice:1450.0,genre:"Animation",director:"Chris Buck, Jennifer Lee",actor:"Idina Menzel",poster:"https://image.tmdb.org/t/p/w500/pjeMs3yqRmFL3giJy4PMXWZTTPa.jpg"},
  {year:2019,title:"Spider-Man: Far From Home",boxOffice:1131.9,genre:"Action / Super-hÃ©ros",director:"Jon Watts",actor:"Tom Holland",poster:"https://image.tmdb.org/t/p/w500/4q2NNj4S5dG2RLF9CpXsej7yXl.jpg"},
  {year:2019,title:"Captain Marvel",boxOffice:1128.4,genre:"Action / Super-hÃ©ros",director:"Anna Boden, Ryan Fleck",actor:"Brie Larson",poster:"https://image.tmdb.org/t/p/w500/AtsgWhDnHTq68L0lLsUrCnM7TjG.jpg"},
  {year:2020,title:"The Eight Hundred",boxOffice:461.4,genre:"Guerre",director:"Guan Hu",actor:"Zhi-zhong Huang",poster:"https://image.tmdb.org/t/p/w500/6PmNCSWE1i0GnxxsABNJhmr6gEz.jpg"},
  {year:2020,title:"Bad Boys for Life",boxOffice:426.5,genre:"Action",director:"Adil El Arbi",actor:"Will Smith",poster:"https://image.tmdb.org/t/p/w500/y95lQLnuNKdPAzw9F9Ab8kJ80c3.jpg"},
  {year:2020,title:"Tenet",boxOffice:365.3,genre:"Science-fiction",director:"Christopher Nolan",actor:"John David Washington",poster:"https://image.tmdb.org/t/p/w500/k68nPLbIST6NP96JmTxmZijEvCA.jpg"},
  {year:2021,title:"Spider-Man: No Way Home",boxOffice:1921.8,genre:"Action / Super-hÃ©ros",director:"Jon Watts",actor:"Tom Holland",poster:"https://image.tmdb.org/t/p/w500/1g0dhYtq4irTY1GPXvft6k4YLjm.jpg"},
  {year:2021,title:"No Time to Die",boxOffice:774.1,genre:"Action",director:"Cary Joji Fukunaga",actor:"Daniel Craig",poster:"https://image.tmdb.org/t/p/w500/iUgygt3fscRoKWCV1d0C7FbM9TP.jpg"},
  {year:2022,title:"Avatar: Way of Water",boxOffice:2320.2,genre:"Science-fiction",director:"James Cameron",actor:"Sam Worthington",poster:"https://image.tmdb.org/t/p/w500/t6HIqrRAclMCA60NsSmeqe9RmNV.jpg"},
  {year:2022,title:"Top Gun: Maverick",boxOffice:1495.7,genre:"Action",director:"Joseph Kosinski",actor:"Tom Cruise",poster:"https://image.tmdb.org/t/p/w500/62HCnUTziyWcpDaBO2i1DX17ljH.jpg"},
  {year:2023,title:"Barbie",boxOffice:1445.6,genre:"ComÃ©die / Fantasy",director:"Greta Gerwig",actor:"Margot Robbie",poster:"https://image.tmdb.org/t/p/w500/iuFNMS8U5cb6xfzi51Dbkovj7vM.jpg"},
  {year:2023,title:"Super Mario Bros Movie",boxOffice:1361.9,genre:"Animation",director:"Aaron Horvath",actor:"Chris Pratt",poster:"https://image.tmdb.org/t/p/w500/qNBAXBIQlnOThrVvA6mA2B5ggV6.jpg"},
  {year:2023,title:"Oppenheimer",boxOffice:975.4,genre:"Drame historique",director:"Christopher Nolan",actor:"Cillian Murphy",poster:"https://image.tmdb.org/t/p/w500/8Gxv8gSFCU0XGDykEGv7zR1n2ua.jpg"}
];

let filteredData = [...movieData];

const genreColors = {
    'Action': '#d4af37', 'Action / Super-hÃ©ros': '#d4af37', 'Animation': '#c9a961',
    'Fantasy': '#b8941f', 'Aventure': '#b8941f', 'Aventure / Fantasy': '#b8941f',
    'Science-fiction': '#a67c00', 'Guerre': '#8b7355', 'Drame historique': '#8b7355'
};

function init() {
    populateFilters();
    applyFilters();
}

function switchTab(event, tabId) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    document.querySelectorAll('.viz-container').forEach(v => v.style.display = 'none');
    document.getElementById(tabId + 'Viz').style.display = 'block';
    applyFilters();
}

function populateFilters() {
    const years = [...new Set(movieData.map(d => d.year))].sort((a,b)=>b-a);
    const genres = [...new Set(movieData.map(d => d.genre))].sort();
    const directors = [...new Set(movieData.map(d => d.director))].sort();
    const actors = [...new Set(movieData.map(d => d.actor || 'Unknown'))].sort();

    const fillSelect = (id, data) => {
        const sel = document.getElementById(id);
        data.forEach(v => { const opt = document.createElement('option'); opt.value = v; opt.textContent = v; sel.appendChild(opt); });
    };

    fillSelect('yearFilter', years);
    fillSelect('genreFilter', genres);
    fillSelect('directorFilter', directors);
    fillSelect('actorFilter', actors);

    ['yearFilter', 'genreFilter', 'directorFilter', 'actorFilter'].forEach(id => {
        document.getElementById(id).addEventListener('change', applyFilters);
    });
}

function applyFilters() {
    const y = document.getElementById('yearFilter').value;
    const g = document.getElementById('genreFilter').value;
    const d = document.getElementById('directorFilter').value;
    const a = document.getElementById('actorFilter').value;

    filteredData = movieData.filter(m => {
        return (y === 'all' || m.year == y) && (g === 'all' || m.genre === g) &&
               (d === 'all' || m.director === d) && (a === 'all' || m.actor === a);
    });

    updateStats();
    drawMainChart();
    drawGenreChart();
    drawDirectorChart();
    drawTimelineChart();
    drawMovieGallery();
}

function resetFilters() {
    ['yearFilter', 'genreFilter', 'directorFilter', 'actorFilter'].forEach(id => document.getElementById(id).value = 'all');
    applyFilters();
}

function updateStats() {
    const totalRev = d3.sum(filteredData, d => d.boxOffice);
    document.getElementById('totalMovies').textContent = filteredData.length;
    document.getElementById('totalBoxOffice').textContent = '$' + (totalRev/1000).toFixed(1) + 'B';
    document.getElementById('avgRevenue').textContent = '$' + (filteredData.length ? (totalRev/filteredData.length).toFixed(1) : 0) + 'M';
    const counts = d3.rollup(filteredData, v => v.length, d => d.genre);
    const top = [...counts.entries()].sort((a,b)=>b[1]-a[1])[0];
    document.getElementById('topGenre').textContent = top ? top[0] : '-';
}

// --- GRAPHIQUES (Style original conservÃ©) ---

function drawMainChart() {
    const container = d3.select('#mainChart'); container.selectAll('*').remove();
    if(!filteredData.length) return;
    const margin = {top:40,right:60,bottom:60,left:80}, width = container.node().clientWidth - margin.left - margin.right, height = 480 - margin.top - margin.bottom;
    const svg = container.append('svg').attr('width', width+margin.left+margin.right).attr('height', height+margin.top+margin.bottom).append('g').attr('transform', `translate(${margin.left},${margin.top})`);
    const x = d3.scaleLinear().domain([d3.min(filteredData, d => d.year)-0.5, d3.max(filteredData, d => d.year)+0.5]).range([0, width]);
    const y = d3.scaleLinear().domain([0, d3.max(filteredData, d => d.boxOffice) * 1.1]).range([height, 0]);
    svg.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-width).tickFormat(''));
    svg.append('g').attr('class','axis').attr('transform',`translate(0,${height})`).call(d3.axisBottom(x).tickFormat(d3.format('d')));
    svg.append('g').attr('class','axis').call(d3.axisLeft(y).tickFormat(d => '$' + d + 'M'));
    const tooltip = d3.select('#tooltip');
    svg.selectAll('circle').data(filteredData).enter().append('circle')
        .attr('cx', d => x(d.year)).attr('cy', d => y(d.boxOffice)).attr('r', 10)
        .attr('fill', d => genreColors[d.genre] || '#d4af37').attr('stroke', '#8b7355').attr('opacity', 0.8)
        .on('mouseover', (e, d) => { tooltip.classed('active', true).html(`<strong>${d.title}</strong><br>$${d.boxOffice}M`).style('left', (e.pageX+10)+'px').style('top', (e.pageY-10)+'px'); })
        .on('mouseout', () => tooltip.classed('active', false));
}

// ... Les autres fonctions de graphiques suivent la mÃªme logique ...
function drawGenreChart() { /* logique d3 */ }
function drawDirectorChart() { /* logique d3 */ }
function drawTimelineChart() { /* logique d3 */ }

// --- GALERIE (Correction TMDB incluse) ---
function drawMovieGallery() {
    const grid = document.getElementById('movieGrid');
    grid.innerHTML = '';
    filteredData.forEach(movie => {
        const card = document.createElement('div');
        card.className = 'movie-card';
        card.innerHTML = `
            <img class="movie-poster" src="${movie.poster}" alt="${movie.title}" loading="lazy" onerror="this.src='https://via.placeholder.com/500x750/1a1a1a/d4af37?text=No+Poster';">
            <div class="movie-info">
                <div class="movie-title">${movie.title}</div>
                <div class="movie-details">${movie.year} â€¢ $${movie.boxOffice}M</div>
            </div>
        `;
        grid.appendChild(card);
    });
}

init();
</script>
</body>
</html>
