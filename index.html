import { useState, useMemo } from "react";
import { Header } from "@/components/Header";
import { YearSlider } from "@/components/YearSlider";
import { MovieCard } from "@/components/MovieCard";
import { MovieModal } from "@/components/MovieModal";
import { BoxOfficeChart } from "@/components/BoxOfficeChart";
import { TopMovieEvolutionChart } from "@/components/TopMovieEvolutionChart";
import { getMoviesByYear, Movie } from "@/data/movies";

const Index = () => {
  const [selectedYear, setSelectedYear] = useState(2023);
  const [selectedMovie, setSelectedMovie] = useState<Movie | null>(null);
  const [isModalOpen, setIsModalOpen] = useState(false);

  const movies = useMemo(() => getMoviesByYear(selectedYear), [selectedYear]);

  const handleMovieClick = (movie: Movie) => {
    setSelectedMovie(movie);
    setIsModalOpen(true);
  };

  const handleCloseModal = () => {
    setIsModalOpen(false);
    setSelectedMovie(null);
  };

  // Separate first place from the rest
  const firstPlace = movies.find((m) => m.rank === 1);
  const otherMovies = movies.filter((m) => m.rank !== 1);

  return (
    <div className="min-h-screen bg-background spotlight-bg">
      <div className="container max-w-6xl mx-auto px-4 pb-16">
        <Header />

        {/* Year Slider */}
        <section className="mb-16">
          <YearSlider selectedYear={selectedYear} onYearChange={setSelectedYear} />
        </section>

        {/* Movies Grid */}
        <section className="mb-12" key={selectedYear}>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {/* First place - featured */}
            {firstPlace && (
              <div className="md:col-span-2 lg:col-span-1 lg:row-span-2">
                <MovieCard
                  movie={firstPlace}
                  onClick={() => handleMovieClick(firstPlace)}
                  isFirst
                />
              </div>
            )}
            
            {/* Other rankings */}
            {otherMovies.map((movie) => (
              <MovieCard
                key={movie.title}
                movie={movie}
                onClick={() => handleMovieClick(movie)}
              />
            ))}
          </div>
        </section>

        {/* Box Office Comparison Chart */}
        <section className="glass-card p-6 md:p-8 mb-8">
          <BoxOfficeChart movies={movies} />
        </section>

        {/* #1 Evolution Chart */}
        <section className="glass-card p-6 md:p-8">
          <TopMovieEvolutionChart />
        </section>

        {/* Movie Detail Modal */}
        <MovieModal
          movie={selectedMovie}
          isOpen={isModalOpen}
          onClose={handleCloseModal}
        />
      </div>

      {/* Footer */}
      <footer className="border-t border-border/30 py-8 text-center">
        <p className="text-sm text-muted-foreground">
          Données : Top 5 Box Office Mondial (2013-2023) • 
          <span className="ml-1">Visualisation de données</span>
        </p>
      </footer>
    </div>
  );
};

export default Index;
